#FROM mcr.microsoft.com/dotnet/core/aspnet:2.2-stretch-slim AS base
#EXPOSE 80
#EXPOSE 443
#ENV ASPNETCORE_CORS http://localhost:4200
#ENV ASPNETCORE_MONGODB mongo

#COPY /bin/Publish/ /app/
#WORKDIR /app
#ENTRYPOINT ["dotnet", "FalabellaPE.Delivery.Api.dll"]

FROM mcr.microsoft.com/dotnet/core/sdk:2.2-stretch AS build
WORKDIR /app
ENV ASPNETCORE_CORS http://localhost:4200
ENV ASPNETCORE_MONGODB mongo

COPY *.sln ./
COPY FalabellaPE.Delivery.Api ./FalabellaPE.Delivery.Api/
COPY FalabellaPE.Delivery.Core ./FalabellaPE.Delivery.Core/
COPY FalabellaPE.Delivery.Data ./FalabellaPE.Delivery.Data/
COPY FalabellaPE.Delivery.Entities ./FalabellaPE.Delivery.Entities/
WORKDIR /app/FalabellaPE.Delivery.Api
RUN dotnet restore 
RUN dotnet publish "FalabellaPE.Delivery.Api.csproj" -c Release -o out

# Imagel final

FROM mcr.microsoft.com/dotnet/core/aspnet:2.2-stretch-slim
WORKDIR /app

COPY --from=build /app/FalabellaPE.Delivery.Api/out .
EXPOSE 80
EXPOSE 443
ENV ASPNETCORE_CORS http://localhost:4200
ENV ASPNETCORE_MONGODB mongo

ENTRYPOINT ["dotnet", "FalabellaPE.Delivery.Api.dll"]
